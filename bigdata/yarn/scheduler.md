> # Yarn调度器介绍

> ### FIFO Scheduler(先进先出调度器)

> ### Capacity Scheduler(容量调度器) 

按照队列分配资源，队列内FIFO，不同队列不能使用多余资源。

> ### Fair Scheduler(公平调度器)

1. 公平调度器，就是能够共享整个集群的资源
2. 不用预先占用资源，每一个作业都是共享的
3. 每当提交一个作业的时候，就会占用整个资源。如果再提交一个作业，那么第一个作业就会分给第二个作业一部分资源，第一个作业也就释放一部分资源。再提交其他的作业时，也同理。。。。也就是说每一个作业进来，都有机会获取资源。

> ### Fair Scheduler与Capacity Scheduler区别

- 资源公平共享：在每个队列中，`Fair Scheduler`可选择按照`FIFO`、`Fair`或`DRF`策略为应用程序分配资源。Fair策略即平均分配，默认情况下，每个队列采用该方式分配资源
- 支持资源抢占：当某个队列中有剩余资源时，调度器会将这些资源共享给其他队列，而当该队列中有新的应用程序提交时，调度器要为它回收资源。为了尽可能降低不必要的计算浪费，调度器采用了先等待再强制回收的策略，即如果等待一段时间后尚有未归还的资源，则会进行资源抢占；从那些超额使用资源的队列中杀死一部分任务，进而释放资源。
- 负载均衡：Fair Scheduler提供了一个基于任务数的负载均衡机制，该机制尽可能将系统中的任务均匀分配到各个节点上。此外，用户也可以根据自己的需求设计负载均衡机制
- 调度策略灵活配置：Fiar Scheduler允许管理员为每个队列单独设置调度策略（当前支持FIFO、Fair或DRF三种）
- 提高小应用程序响应时间：由于采用了最大最小公平算法，小作业可以快速获取资源并运行完成

> ### `DRF(Dominant Resource Fairness)`

> ### `资源比较器` http://hadoop.apache.org/docs/r2.7.3/hadoop-yarn/hadoop-yarn-site/CapacityScheduler.html

- `DefaultResourceCalculator`：只考虑内存资源
    - 若 s1紧需资源（使用资源量小于最小资源保证即紧需资源），s2 紧需资源，把资源给 s1
    - 若 s2紧需资源，s1 不紧需资源，把资源给 s2
    - 若 s1、s2 都紧需资源，把资源给 minShareRatio 更小的，minShareRatio1 = 已使用内存/ 最小资源保证
    - 若 s1、s2 都不紧需资源， 把资源给 useToWeightRatio 更小的, useToWeightRatio = 已使用内存 / 权重
    - 若 s1、s2 都不紧需资源且useToWeightRatio相同，把资源给更早启动的

- `DominantResourceCalculator`：采用了 DRF 比较算法，同时考虑内存和 cpu 两种资源

其基本思想是，在多资源环境中，`资源分配`应由实体（用户或队列）的`主要份额决定`，这是实体已分配的任何资源的最大份额。简言之，它寻求最大限度地提高所有实体的最低主导份额。例如，如果用户A运行CPU密集型任务，而用户B运行内存密集型任务，则会尝试使用户A的CPU共享与用户B的内存共享相等。在单个资源的情况下，会降低该资源的最大-最小公平性。

有关详细信息，请参阅主要资源公平性白皮书： http://www.cs.berkeley.edu/~matei/papers/2011/nsdi_drf.pdf